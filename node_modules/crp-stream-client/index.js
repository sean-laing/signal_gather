var config = require('./config');
var TaskStream = require('./tasks-stream');
var ResultsStream = require('./results-stream');
var ErrorsStream = require('./errors-stream');

module.exports = Client;

function Client(options) {
  var defaultReqOpts = {
    headers: {
      "Content-Type": "application/json"
    }
  };

  if (!options) {
    options = {};
  }

  if (options.token)
    defaultReqOpts.headers.Authorization = "token " + options.token;

  if (options.email && options.password)
    defaultReqOpts.headers.Authorization = "Basic "+
      (new Buffer(options.email+':'+options.password)
        .toString('base64'));

  options.baseUrl = config.server.url + '/jobs/';

  return function streams (jobId) {
    return {
      Tasks: TaskStream(jobId, defaultReqOpts, options),
      Results: ResultsStream(jobId, defaultReqOpts, options),
      Errors: ErrorsStream(jobId, defaultReqOpts, options),
    };
  };
}
